### **什么是 Base64？**

**Base64** 是一种基于 64 个可打印字符（ASCII 编码）的编码方式，用于将**二进制数据**转换为**文本数据**。  
它常用于**网络传输**、**文件嵌入**或其他需要避免非文本数据的问题场景。

Base64 不是加密，而是一种**编码方法**，目的是方便数据存储和传输。

---

### **为什么需要 Base64？**

1. **避免特殊字符的问题**：  
   - 在某些协议或格式中（如 HTTP、JSON、XML），二进制数据（如图片、音频）可能无法直接传输或存储。
   - Base64 将这些二进制数据转换为纯文本，便于兼容。

2. **确保安全传输**：  
   - 有些网络协议只支持 ASCII 字符（如 SMTP 邮件协议）。Base64 将数据转换为 ASCII 字符，确保其能被正确传输。

---

### **Base64 编码原理**

1. **6-bit 分组**：  
   - 二进制数据以 **3 个字节（24 位）为一组**，每 6 位作为一个单元分组。  
     因为 \(2^6 = 64\)，每个分组可以映射到 64 个字符。

2. **字符映射表**：  
   - Base64 使用以下字符表：
     ```
     A-Z (26 个大写字母)
     a-z (26 个小写字母)
     0-9 (10 个数字)
     + 和 / (两个符号)
     ```
   - 总共 64 个字符。

3. **填充（Padding）**：  
   - 如果输入数据的长度不是 3 的倍数，Base64 会在末尾用 `=` 补足。

---

### **Base64 编码步骤**

#### **1. 将数据转为二进制**
假设输入数据是 `Man`：  
- ASCII 编码：
  ```
  M -> 77
  a -> 97
  n -> 110
  ```
- 二进制表示（8 位一组）：
  ```
  M: 01001101
  a: 01100001
  n: 01101110
  ```

#### **2. 将二进制分组（6-bit 一组）**
将 24 位的二进制数据分为 4 组，每组 6 位：
```
010011 010110 000101 101110
```

#### **3. 将每组二进制映射为 Base64 字符**
根据 Base64 字符表：
```
010011 -> T
010110 -> W
000101 -> F
101110 -> u
```
所以，`Man` 的 Base64 编码结果是：`TWFu`

---

### **Base64 填充规则**

1. **数据长度不是 3 的倍数时**：
   - 不足 3 个字节的数据末尾补 `\x00`（8 个 0）再编码。
   - 最后用 `=` 替代补的 0。

2. **举例：**
   - 输入数据 `Ma`：
     - 二进制：`M -> 77 (01001101)`，`a -> 97 (01100001)`
     - 合并：`01001101 01100001`（16 位）
     - 补齐：`01001101 01100001 00000000`（24 位）
     - 分组：`010011 010110 000100 000000`
     - 映射：`T W E A`
     - **结果：**`TWE=`

---

### **Base64 解码**

解码是编码的逆过程：
1. 将 Base64 字符映射回 6 位二进制。
2. 按组还原成 8 位的字节。
3. 去掉填充的 `\x00`，还原原始数据。

---

### **应用场景**

1. **网络传输**：
   - 通过 HTTP 或 WebSocket 传输图像、音频等二进制数据时，Base64 避免了字符编码问题。
   
2. **数据嵌入**：
   - 在 HTML 或 CSS 中嵌入图片：
     ```html
     <img src="data:image/png;base64,iVBORw0KGgoAAAANS...">
     ```

3. **加密结果表示**：
   - 加密后的二进制数据（如 RSA、AES 密文）通常用 Base64 表示，便于存储或传输。

4. **JWT (JSON Web Token)**：
   - Base64 用于对 JWT 的头部、载荷进行编码。

---

### **优缺点**

#### **优点**：
- 可将二进制数据安全地转换为文本形式。
- 兼容几乎所有协议和存储格式。

#### **缺点**：
- **增加体积**：Base64 会将数据体积增大约 **33%**（因为每 3 字节编码为 4 个字符）。
- **性能损耗**：编码和解码需要额外的计算。

---

### **示例代码**

#### **Python**
```python
import base64

# 编码
data = "hello"
encoded = base64.b64encode(data.encode("utf-8"))
print("Base64 编码：", encoded.decode())

# 解码
decoded = base64.b64decode(encoded).decode("utf-8")
print("解码后：", decoded)
```

#### **Java**
```java
import java.util.Base64;

public class Main {
    public static void main(String[] args) {
        String data = "hello";

        // 编码
        String encoded = Base64.getEncoder().encodeToString(data.getBytes());
        System.out.println("Base64 编码：" + encoded);

        // 解码
        byte[] decodedBytes = Base64.getDecoder().decode(encoded);
        String decoded = new String(decodedBytes);
        System.out.println("解码后：" + decoded);
    }
}
```

---
